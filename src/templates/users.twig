{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Isolate plugin for Craft CMS 3.x
 *
 * Isolate index.twig
 *
 * @author    TrendyMinds
 * @copyright Copyright (c) 2019 TrendyMinds
 * @link      https://trendyminds.com
 * @package   Isolate
 * @since     1.0.0
 */
#}

{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("trendyminds\\isolate\\assetbundles\\isolate\\IsolateAsset") %}
{% do view.registerAssetBundle("trendyminds\\isolate\\assetbundles\\indexcpsection\\IndexCPSectionAsset") %}

{% set selectedSubnavItem = "users" %}
{% set title = user is not defined ? "Users" : user.name %}
{% set fullPageForm = true %}

{% set pluginCpUrl = url('isolate') %}

{% block sidebar %}
  <nav>
    <ul>
      <li class="heading"><span>Users</span></li>
      {% for user in craft.isolate.users %}
        <li><a href="{{url('isolate/users/' ~ user.id)}}" class="{{id == user.id ? 'sel' : ''}}">{{user.name}}</a></li>
      {% endfor %}
    </ul>
  </nav>
{% endblock %}

{% set content %}
  {% if sections is defined %}
    {% for section in sections %}
      <h2>{{section.name}}</h2>

      {% if section.canEdit %}
        {% set options = [] %}

        {% for entry in craft.entries.section(section.handle).limit(NULL).all() %}
          {% set options = options | merge([{
              label: entry.title,
              id: entry.id,
              checked: true,
              disabled: true
            }])
          %}
        {% endfor %}

        {{ forms.checkboxGroupField({
            label: "",
            name: section.handle,
            options: options
          })
        }}
      {% endif %}

      {% if not section.canEdit %}
        <p class="light">This user currently does not have permission to edit <strong>{{section.name}}</strong> entries.</p>
        <p><a href="{{url('users/' ~ user.id)}}#perms" class="go">Modify this user's permissions</a></p>
      {% endif %}

      <hr>
    {% endfor %}
  {% endif %}
{% endset %}
